

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Class DataLayer &mdash; Rain 0.18.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.18.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Rain 0.18.0 documentation" href="../../index.html" />
    <link rel="next" title="Class DemoIdentityProvider" href="../api/DemoIdentityProvider.html" />
    <link rel="prev" title="Class CssHelper" href="../api/CssHelper.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../api/DemoIdentityProvider.html" title="Class DemoIdentityProvider"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../api/CssHelper.html" title="Class CssHelper"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">Rain 0.18.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="class-datalayer">
<h1>Class DataLayer<a class="headerlink" href="#class-datalayer" title="Permalink to this headline">¶</a></h1>
<p>The data layer allows developers to pass custom data to the view templates. When the template is
executed it can use this data to construct dynamic markup. The data can be obtained by calling a
web service or it can be constructed inside the data layer function.</p>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>The Handlebars context in which the component helper was used is passed to the data layer method
in the <tt class="docutils literal"><span class="pre">context</span></tt> parameter. If the <tt class="docutils literal"><span class="pre">data.js</span></tt> file or the method for the view doesn&#8217;t exist, this
data will become the context used to execute the template associated with the aggregated component.</p>
<p>Data layer methods are placed in the <tt class="docutils literal"><span class="pre">/server/data.js</span></tt> file. In order to define a data
method for a view a function with the same name as the <em>view id</em> should be created in this file and
exported as part of the public API of this module.</p>
<dl class="docutils">
<dt>This method receives four parameters:</dt>
<dd><ul class="first last">
<li><p class="first"><tt class="docutils literal"><span class="pre">environment</span></tt> contains information about the RAIN environment;</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">callback</span></tt> represents a function that should be called after the custom data is constructed. It
accepts two parameters: an error (or <tt class="docutils literal"><span class="pre">null</span></tt> if no error occurred) and the custom data;</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">context</span></tt> contains the Handlebars context in which the component was aggregated and the
options that were passed to the component helper;</p>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">request</span></tt> has five properties:</dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">session</span></tt>: the session for the current request;</li>
<li><tt class="docutils literal"><span class="pre">query</span></tt>: the query parameters for the current page;</li>
<li><tt class="docutils literal"><span class="pre">headers</span></tt>: the request headers;</li>
<li><tt class="docutils literal"><span class="pre">url</span></tt>: the URL of the current page;</li>
<li><tt class="docutils literal"><span class="pre">type</span></tt>: HTTP or WebSocket. When the component is requested via web sockets
only <tt class="docutils literal"><span class="pre">session</span></tt> and <tt class="docutils literal"><span class="pre">type</span></tt> are available.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">/meta.json</span></tt></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;button&quot;</span><span class="p">,</span>
    <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;views&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;index&quot;</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;view&quot;</span><span class="o">:</span> <span class="s2">&quot;index.html&quot;</span><span class="p">,</span>
            <span class="s2">&quot;controller&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;client&quot;</span><span class="o">:</span> <span class="s2">&quot;index.js&quot;</span><span class="p">,</span>
                <span class="s2">&quot;server&quot;</span><span class="o">:</span> <span class="s2">&quot;index.js&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;index1&quot;</span> <span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;view&quot;</span><span class="o">:</span> <span class="s2">&quot;index1.html&quot;</span><span class="p">,</span>
            <span class="s2">&quot;controller&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;client&quot;</span><span class="o">:</span> <span class="s2">&quot;index1.js&quot;</span><span class="p">,</span>
                <span class="s2">&quot;server&quot;</span><span class="o">:</span> <span class="s2">&quot;index1.js&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">/server/data.js</span></tt></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">index</span><span class="p">(</span><span class="nx">environment</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">customData</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">field1</span><span class="o">:</span> <span class="nx">data</span><span class="p">,</span>
        <span class="nx">field2</span><span class="o">:</span> <span class="s1">&#39;value&#39;</span>
    <span class="p">};</span>

    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">customData</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">index1</span><span class="p">(</span><span class="nx">environment</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">getData</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">customData</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">customData</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">index</span><span class="o">:</span> <span class="nx">index</span><span class="p">,</span>
    <span class="nx">index1</span><span class="o">:</span> <span class="nx">index1</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference internal" href="../api/Environment.html#Environment" title="Environment"><tt class="xref js js-class docutils literal"><span class="pre">Environment()</span></tt></a></dt>
<dd>Environment API</dd>
</dl>
</div>
<div class="section" id="constructor">
<h3>Constructor<a class="headerlink" href="#constructor" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="DataLayer">
<em class="property">class </em><tt class="descname">DataLayer</tt><big>(</big><big>)</big><a class="headerlink" href="#DataLayer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="methods">
<h3>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h3>
<div class="section" id="loaddata">
<h4>loadData<a class="headerlink" href="#loaddata" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="DataLayer#loadData">
<tt class="descname">DataLayer#loadData</tt><big>(</big><em>componentOpt</em>, <em>callback</em><big>)</big><a class="headerlink" href="#DataLayer#loadData" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>componentOpt</strong> (<em>Object</em>) &#8211; the component information</li>
<li><strong>componentOpt.id</strong> (<em>Object</em>) &#8211; the component id</li>
<li><strong>componentOpt.version</strong> (<em>Object</em>) &#8211; the component version</li>
<li><strong>componentOpt.viewId</strong> (<em>Object</em>) &#8211; the view id</li>
<li><strong>componentOpt.context</strong> (<em>Object</em>) &#8211; the current Handlebars context</li>
<li><strong>componentOpt.session</strong> (<em>Object</em>) &#8211; the session for the current request</li>
<li><strong>componentOpt.[request]</strong> (<em>Object</em>) &#8211; the current request object; this parameter is missing when the component is retrieved via web sockets</li>
<li><strong>callback</strong> (<em>Function</em>) &#8211; receives the error and data as parameter</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Validates all necessary parameters and invokes the data function from the component
to receive custom data. When the data returns, it calls the callback function.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Class DataLayer</a><ul>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#constructor">Constructor</a></li>
<li><a class="reference internal" href="#methods">Methods</a><ul>
<li><a class="reference internal" href="#loaddata">loadData</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../api/CssHelper.html"
                        title="previous chapter">Class CssHelper</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../api/DemoIdentityProvider.html"
                        title="next chapter">Class DemoIdentityProvider</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../api/DemoIdentityProvider.html" title="Class DemoIdentityProvider"
             >next</a> |</li>
        <li class="right" >
          <a href="../api/CssHelper.html" title="Class CssHelper"
             >previous</a> |</li>
        <li><a href="../../index.html">Rain 0.18.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>